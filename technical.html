<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æŠ€æœ¯åˆ†æ â€” Alpha Factor Lab</title>
<style>
:root {
  --bg: #0f1117; --card: #1a1d29; --border: #2a2d3a;
  --text: #e4e6eb; --text2: #8b8fa3; --accent: #4f8cff;
  --green: #22c55e; --red: #ef4444; --orange: #f59e0b; --purple: #a855f7;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }

.header {
  text-align: center;
  padding: 32px 0 24px;
  border-bottom: 1px solid var(--border);
}
.header h1 { font-size: 2rem; font-weight: 700; margin-bottom: 4px; }
.header h1 .icon { font-size: 1.6rem; margin-right: 8px; }
.header .subtitle { color: var(--text2); font-size: 0.95rem; }
.nav-links { margin-top: 12px; }
.nav-links a {
  margin: 0 8px;
  padding: 6px 16px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 0.85rem;
  transition: all .2s;
  display: inline-block;
}
.nav-links a:hover { border-color: var(--accent); background: rgba(79,140,255,.1); text-decoration: none; }

.container { max-width: 1200px; margin: 0 auto; padding: 24px 16px; }

.empty-state {
  text-align: center;
  padding: 80px 20px;
  color: var(--text2);
}
.empty-state .icon { font-size: 4rem; margin-bottom: 20px; display: block; }
.empty-state h2 { font-size: 1.3rem; color: var(--text); margin-bottom: 12px; }
.empty-state p { max-width: 500px; margin: 0 auto; font-size: 0.95rem; line-height: 1.7; }

.report-list { display: flex; flex-direction: column; gap: 16px; }

.report-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  cursor: pointer;
  transition: all 0.2s;
}
.report-card:hover { border-color: var(--accent); transform: translateY(-1px); }
.report-card.active { border-color: var(--accent); }

.report-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
.report-name { font-size: 1.15rem; font-weight: 600; }
.report-code { color: var(--text2); font-size: 0.85rem; margin-left: 8px; }
.report-date { color: var(--text2); font-size: 0.8rem; }

.price-info { display: flex; align-items: baseline; gap: 12px; margin: 8px 0; }
.price { font-size: 1.5rem; font-weight: 700; }
.price.up { color: var(--red); }
.price.down { color: var(--green); }
.change { font-size: 0.95rem; font-weight: 600; }
.change.up { color: var(--red); }
.change.down { color: var(--green); }

.signal-badge {
  display: inline-block;
  padding: 3px 12px;
  border-radius: 20px;
  font-size: 0.78rem;
  font-weight: 600;
}
.signal-buy { background: rgba(34,197,94,0.15); color: var(--green); }
.signal-sell { background: rgba(239,68,68,0.15); color: var(--red); }
.signal-hold { background: rgba(245,158,11,0.15); color: var(--orange); }
.signal-neutral { background: rgba(139,143,163,0.15); color: var(--text2); }

.tag-bar {
  display: flex;
  gap: 8px;
  margin-top: 10px;
  flex-wrap: wrap;
}
.tag {
  background: rgba(79,140,255,0.08);
  border: 1px solid rgba(79,140,255,0.15);
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 0.78rem;
  color: var(--text2);
}

.detail-panel {
  display: none;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 30px;
  margin-top: 16px;
  animation: fadeIn 0.3s;
}
.detail-panel.show { display: block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

.detail-section {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}
.detail-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.detail-section h3 {
  font-size: 1rem;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.detail-section h3 .dot { width: 4px; height: 16px; border-radius: 2px; background: var(--accent); }

.chart-container {
  margin: 16px 0;
  text-align: center;
}
.chart-container img {
  max-width: 100%;
  border-radius: 8px;
  border: 1px solid var(--border);
}

.key-levels {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 10px;
}
.level-item {
  display: flex;
  justify-content: space-between;
  padding: 10px 14px;
  background: rgba(255,255,255,0.02);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}
.level-item.resistance { border-left-color: var(--red); }
.level-item.support { border-left-color: var(--green); }
.level-item.current { border-left-color: var(--accent); background: rgba(79,140,255,0.05); }
.level-item .lk { color: var(--text2); font-size: 0.85rem; }
.level-item .lv { font-weight: 600; font-size: 0.9rem; }

.signal-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.signal-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  background: rgba(255,255,255,0.02);
  border-radius: 8px;
}
.signal-item .s-type { font-weight: 600; font-size: 0.88rem; min-width: 100px; }
.signal-item .s-date { color: var(--text2); font-size: 0.82rem; }
.signal-item .s-str { font-size: 0.82rem; padding: 2px 8px; border-radius: 4px; }
.s-str.strong-buy { background: rgba(34,197,94,0.2); color: var(--green); }
.s-str.buy { background: rgba(34,197,94,0.1); color: #4ade80; }
.s-str.sell { background: rgba(239,68,68,0.1); color: #f87171; }
.s-str.strong-sell { background: rgba(239,68,68,0.2); color: var(--red); }
.s-str.neutral { background: rgba(139,143,163,0.1); color: var(--text2); }

.summary-text {
  color: var(--text2);
  font-size: 0.92rem;
  line-height: 1.75;
  white-space: pre-wrap;
}

.indicator-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 12px;
}
.indicator-card {
  padding: 14px;
  background: rgba(255,255,255,0.02);
  border-radius: 8px;
  border: 1px solid var(--border);
}
.indicator-card h4 { font-size: 0.9rem; margin-bottom: 6px; color: var(--text); }
.indicator-card p { font-size: 0.85rem; color: var(--text2); line-height: 1.6; }

.footer {
  text-align: center;
  padding: 24px;
  color: var(--text2);
  font-size: 0.8rem;
  border-top: 1px solid var(--border);
  margin-top: 40px;
}
</style>
</head>
<body>

<div class="header">
  <h1><span class="icon">ğŸ“ˆ</span>æŠ€æœ¯åˆ†æ</h1>
  <p class="subtitle">Kçº¿å½¢æ€ Â· æŒ‡æ ‡ä¿¡å· Â· ä¹°å–ç‚¹è¯†åˆ«</p>
  <div class="nav-links">
    <a href="index.html">â† é¦–é¡µ</a>
    <a href="fundamental.html">åŸºæœ¬é¢åˆ†æ</a>
    <a href="factor-backtest.html">å› å­å›æµ‹</a>
    <a href="paper-trading.html">æ¨¡æ‹Ÿç›˜</a>
  </div>
</div>

<div class="container">
  <div id="report-list" class="report-list"></div>
  <div id="detail-panel" class="detail-panel"></div>
  <div id="empty-state" class="empty-state" style="display:none;">
    <span class="icon">ğŸ“‰</span>
    <h2>æš‚æ— æŠ€æœ¯åˆ†ææŠ¥å‘Š</h2>
    <p>é€šè¿‡ AI åŠ©æ‰‹è¿è¡ŒæŠ€æœ¯åˆ†æåï¼ŒæŠ¥å‘Šä¼šè‡ªåŠ¨å±•ç¤ºåœ¨è¿™é‡Œã€‚<br>ç¤ºä¾‹æŒ‡ä»¤ï¼šã€Œå¸®æˆ‘çœ‹çœ‹èŒ…å°çš„æŠ€æœ¯é¢ã€</p>
  </div>
</div>

<div class="footer">
  Alpha Factor Lab Â· <a href="index.html">è¿”å›é¦–é¡µ</a>
</div>

<script>
const DATA_FILE = 'technical-reports.json';

function signalClass(s) {
  if (!s) return 'signal-neutral';
  if (s.includes('ä¹°å…¥') || s.includes('åšå¤š')) return 'signal-buy';
  if (s.includes('å–å‡º') || s.includes('åšç©º') || s.includes('å›é¿')) return 'signal-sell';
  if (s.includes('æŒæœ‰') || s.includes('è§‚æœ›')) return 'signal-hold';
  return 'signal-neutral';
}

function strengthClass(s) {
  if (!s) return 'neutral';
  if (s.includes('å¼ºä¹°') || s === 'å¼º') return 'strong-buy';
  if (s.includes('ä¹°') || s.includes('ä¸­ç­‰')) return 'buy';
  if (s.includes('å¼ºå–')) return 'strong-sell';
  if (s.includes('å–')) return 'sell';
  return 'neutral';
}

function renderDetail(r) {
  const panel = document.getElementById('detail-panel');
  let html = '';

  // å›¾è¡¨
  if (r.chart) {
    html += `<div class="detail-section">
      <h3><span class="dot"></span>ğŸ“Š æŠ€æœ¯åˆ†æå›¾è¡¨</h3>
      <div class="chart-container">
        <img src="${r.chart}?t=${Date.now()}" alt="${r.name} æŠ€æœ¯åˆ†æå›¾è¡¨" loading="lazy"
             onerror="this.parentElement.innerHTML='<p style=\\'color:var(--text2)\\'>å›¾è¡¨æš‚æœªç”Ÿæˆ</p>'">
      </div>
    </div>`;
  }

  // ä¸€å¥è¯æ€»ç»“
  if (r.summary) {
    html += `<div class="detail-section">
      <h3><span class="dot"></span>ğŸ“ åˆ†ææ‘˜è¦</h3>
      <p class="summary-text">${r.summary}</p>
    </div>`;
  }

  const a = r.analysis || {};

  // è¶‹åŠ¿ç ”åˆ¤
  if (a.trend) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ“ˆ è¶‹åŠ¿ç ”åˆ¤</h3>`;
    let trendText = '';
    if (a.trend.short) trendText += 'çŸ­æœŸè¶‹åŠ¿ï¼š' + a.trend.short + '\n';
    if (a.trend.mid) trendText += 'ä¸­æœŸè¶‹åŠ¿ï¼š' + a.trend.mid + '\n';
    if (a.trend.ma_status) trendText += 'å‡çº¿çŠ¶æ€ï¼š' + a.trend.ma_status;
    html += `<p class="summary-text">${trendText}</p></div>`;
  }

  // ä¹°å–ä¿¡å·
  if (a.signals && a.signals.length) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ¯ ä¹°å–ä¿¡å·</h3><div class="signal-list">`;
    a.signals.forEach(s => {
      html += `<div class="signal-item">
        <span class="s-type">${s.type||''}</span>
        <span class="s-date">${s.date||''}</span>
        <span class="s-str ${strengthClass(s.strength)}">${s.strength||''}</span>
      </div>`;
    });
    html += '</div></div>';
  }

  // æŠ€æœ¯æŒ‡æ ‡
  if (a.indicators) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ”§ æŠ€æœ¯æŒ‡æ ‡</h3><div class="indicator-grid">`;
    const ind = a.indicators;
    if (ind.macd) html += `<div class="indicator-card"><h4>MACD</h4><p>${ind.macd}</p></div>`;
    if (ind.kdj) html += `<div class="indicator-card"><h4>KDJ</h4><p>${ind.kdj}</p></div>`;
    if (ind.rsi) html += `<div class="indicator-card"><h4>RSI</h4><p>${ind.rsi}</p></div>`;
    if (ind.boll) html += `<div class="indicator-card"><h4>BOLLå¸ƒæ—å¸¦</h4><p>${ind.boll}</p></div>`;
    html += '</div></div>';
  }

  // é‡èƒ½åˆ†æ
  if (a.volume) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ“Š é‡èƒ½åˆ†æ</h3>`;
    let volText = '';
    if (a.volume.summary) volText += a.volume.summary + '\n';
    if (a.volume.obv_trend) volText += 'OBVèƒ½é‡æ½®ï¼š' + a.volume.obv_trend;
    html += `<p class="summary-text">${volText}</p></div>`;
  }

  // å…³é”®ä»·ä½
  if (a.key_levels) {
    const lv = a.key_levels;
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ“ å…³é”®ä»·ä½</h3><div class="key-levels">`;
    if (lv.strong_resistance) html += `<div class="level-item resistance"><span class="lk">å¼ºå‹åŠ›ä½</span><span class="lv">${lv.strong_resistance}</span></div>`;
    if (lv.resistance) html += `<div class="level-item resistance"><span class="lk">å‹åŠ›ä½</span><span class="lv">${lv.resistance}</span></div>`;
    html += `<div class="level-item current"><span class="lk">å½“å‰ä»·</span><span class="lv">${r.price||'-'}</span></div>`;
    if (lv.support) html += `<div class="level-item support"><span class="lk">æ”¯æ’‘ä½</span><span class="lv">${lv.support}</span></div>`;
    if (lv.strong_support) html += `<div class="level-item support"><span class="lk">å¼ºæ”¯æ’‘ä½</span><span class="lv">${lv.strong_support}</span></div>`;
    html += '</div></div>';
  }

  // æ“ä½œå»ºè®®
  if (a.action) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ’¡ æ“ä½œå»ºè®®</h3>`;
    let actText = '';
    if (a.action.buy_strategy) actText += 'ä¹°å…¥ç­–ç•¥ï¼š' + a.action.buy_strategy + '\n';
    if (a.action.sell_strategy) actText += 'å–å‡ºç­–ç•¥ï¼š' + a.action.sell_strategy + '\n';
    if (a.action.stop_loss) actText += 'æ­¢æŸè®¾ç½®ï¼š' + a.action.stop_loss;
    html += `<p class="summary-text">${actText}</p></div>`;
  }

  // é£é™©æç¤º
  if (r.risks && r.risks.length) {
    html += `<div class="detail-section"><h3><span class="dot"></span>âš ï¸ é£é™©æç¤º</h3>`;
    html += `<p class="summary-text">${r.risks.map(x=>'â€¢ '+x).join('\n')}</p></div>`;
  }

  panel.innerHTML = html;
  panel.classList.add('show');
}

async function init() {
  const listEl = document.getElementById('report-list');
  const emptyEl = document.getElementById('empty-state');
  const panel = document.getElementById('detail-panel');

  let reports = [];
  try {
    const resp = await fetch(DATA_FILE + '?t=' + Date.now(), {cache: 'no-cache'});
    if (!resp.ok) throw new Error('no data');
    reports = await resp.json();
  } catch(e) {
    emptyEl.style.display = 'block';
    return;
  }

  if (!reports.length) {
    emptyEl.style.display = 'block';
    return;
  }

  reports.sort((a,b) => (b.date||'').localeCompare(a.date||''));

  listEl.innerHTML = reports.map((r, i) => {
    const changePct = r.change_pct || 0;
    const upDown = changePct >= 0 ? 'up' : 'down';
    return `
    <div class="report-card" data-idx="${i}">
      <div class="report-top">
        <div>
          <span class="report-name">${r.name||'æœªçŸ¥'}</span>
          <span class="report-code">${r.code||''}</span>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
          <span class="signal-badge ${signalClass(r.signal)}">${r.signal||'æœªçŸ¥'}</span>
          <span class="report-date">${r.date||''}</span>
        </div>
      </div>
      <div class="price-info">
        <span class="price ${upDown}">${r.price ? r.price.toFixed(2) : '-'}</span>
        <span class="change ${upDown}">${changePct >= 0 ? '+' : ''}${changePct.toFixed(2)}%</span>
        <span style="color:var(--text2);font-size:0.85rem;">è¶‹åŠ¿: ${r.trend||'-'}</span>
      </div>
      <div class="tag-bar">
        ${(r.analysis?.signals||[]).slice(-4).map(s => `<span class="tag">${s.type} (${s.date||''})</span>`).join('')}
      </div>
    </div>`;
  }).join('');

  let activeIdx = -1;
  listEl.querySelectorAll('.report-card').forEach(card => {
    card.addEventListener('click', () => {
      const idx = parseInt(card.dataset.idx);
      listEl.querySelectorAll('.report-card').forEach(c => c.classList.remove('active'));
      if (idx === activeIdx) {
        activeIdx = -1;
        panel.classList.remove('show');
        return;
      }
      activeIdx = idx;
      card.classList.add('active');
      renderDetail(reports[idx]);
    });
  });
}

init();
</script>
</body>
</html>
