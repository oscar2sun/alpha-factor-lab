# 2026-02-23 工作日志

## 慧博金工研报扫描（因子挖掘灵感）
- 孙瑞要求搜慧博资讯金融工程板块，寻找因子挖掘启发
- web_fetch无法抓取慧博（全站动态渲染），改用浏览器直接导航
- 成功浏览 hibor.com.cn/microns_18.html 金融工程板块，获取近两周研报列表
- 进入华福证券"剔除低预期的GRU弹性赛道优选"详情页，获取摘要（正文需登录）

### 关键研报发现
1. **华福证券 - GRU弹性赛道优选**（2/20，35页）
   - 行业+市场双分支GRU → 行业相对强弱分数
   - 三层叠加：深度学习因子 + 分析师预期因子 + 基本面因子
   - 先筛弹性赛道，再剔除低预期陷阱

2. **华福证券 - 策略化选股月报**（2/3，33页）
   - 科创策略、情绪价量因子2026年1月表现最好

3. **开源证券 - 太空光伏板块资金行为监测**（2/12，10页）
   - 主力净流入、大单占比等资金行为数据构建板块监测信号

4. **光大证券 - 因子周度跟踪**
   - Beta因子+1.11%（正）、成长因子表现出色
   - 残差波动率-0.54%、估值-0.40%、盈利-0.31%（均负）
   - 大宗交易组合再创新高（折价因子有效）

5. **开源证券 - 港股CCASS优选20组合**
   - "先选经纪商，再选个股"两步法，港股托管数据因子

### 建议的3个因子方向（已告知孙瑞，待他选择）
1. 分析师预期修正加速度因子（一致预期EPS二阶导）
2. 情绪价量复合因子（换手率z-score × 量价相关性 × 涨停溢价率）
3. 资金行为因子（主力净买入占比 + 大单成交占比时序动量）

## 三因子构建与回测（已完成）

### 数据获取
- 沪深300成分股，300只全部获取
- K线: 2022-10-10 ~ 2026-02-13, 243046行, 817个交易日
- 资金流: 东方财富最近120天，300只×120天=36000行
- 数据源: akshare (新安装)

### 因子1: 预期修正加速度 (analyst_revision_accel) ★★☆
- 构造: 超额收益加速度 = (近20日累计超额 - 前20日累计超额) / (40日超额波动×√20)
- IC=0.015 不显著(t=1.27), Rank IC=0.011
- 多空年化12.1%, Sharpe=0.66, MDD=-16.9%
- 单调性0.70, G5年化15.2% > G1的1.5%
- 换手率61.7%, 成本敏感
- 评价: 中等，分层效果可以但IC不显著

### 因子2: 情绪价量复合 (sentiment_pv_composite) ★☆☆  
- 构造: 换手率z-score × |5日量价相关| × 10日平均振幅
- IC=0.004 不显著(t=0.33), 单调性0.40
- 多空年化7.0%, Sharpe=0.48
- 发现: 高情绪组收益更好（与"过热=负面"假设相反）
- 换手率74% 过高
- 评价: 较弱，在大盘股上高关注度是正面信号

### 因子3: 资金行为动量 (money_flow_momentum) ☆☆☆
- 构造: 主力净占比5日均值-20日均值（近120天真实数据+早期用均价溢价率代理）
- IC=-0.012 不显著(t=-0.93), 多空收益-21.8%
- 单调性-0.10, 完全无效
- 教训: 大盘股资金流噪声大, 均价溢价率代理质量差, 应在中小盘测试
- 评价: 无效, 不建议使用

### 写入阿尔法工坊
- factors.json 更新至15个因子
- 3个因子的回测数据+图表push到GitHub (commit d439d2f)
- 阿尔法工坊: https://oscar2sun.github.io/alpha-factor-lab/factor-backtest.html

### 关键教训
1. 免费API限制: 无法获取300只股票的历史一致预期EPS时序 → 用超额收益代理
2. 东方财富资金流只有120天 → 长回测需要代理因子补充（但质量打折扣）
3. 沪深300特性: "情绪过热≠负面信号"、"主力资金流≠信息优势" → 大盘股逻辑与中小盘不同
4. akshare已安装可用, scipy已安装

## 因子库清理与重建（下午）

### 孙瑞反馈
- 15个因子都不太行，问是不是回测有问题
- 我诊断：回测框架没问题，问题在于①早期因子样本太小(43~75只)②沪深300难做alpha③因子构造太简单(无中性化)
- 给了4个改进方向：A基础设施升级/B因子工程升级/C换中证1000/D换数据源
- 孙瑞指示：①清掉所有因子②挑有前景的升级后在中证1000上跑

### 执行
- factors.json 清空（commit 0f09b0d）
- 精选3个有潜力因子升级：Amihud非流动性、预期修正加速度、振幅疲劳
- 升级方向：行业/市值中性化 + 参数优化 + 中证1000股票池
- 中证1000成分股获取完成：1000只
- K线下载完成：~1000只，2022-10~2026-02，约80万行（akshare批量下载，耗时约25分钟）
  - 缓存文件：data/csi1000_kline_raw.csv
  - 下载脚本：scripts/fetch_kline_csi1000.py

### 待完成
- [ ] 写升级版因子构建脚本（含行业/市值中性化）
- [ ] 3个因子在中证1000上回测
- [ ] 结果写入factors.json + push
- [ ] 飞书报告结果

## 其他
- daily-log-push cron 昨晚（2/22 23:59）应该已经运行，待验证结果
- fundamental.html UX修复（detail panel插入位置）已push，待验证GitHub Pages部署
- 飞书消息通道正常，accountId用"main"（不是"default"）
