<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸºæœ¬é¢åˆ†ææŠ¥å‘Š â€” Alpha Factor Lab</title>
<style>
:root {
  --bg: #0f1117; --card: #1a1d29; --border: #2a2d3a;
  --text: #e4e6eb; --text2: #8b8fa3; --accent: #4f8cff;
  --green: #22c55e; --red: #ef4444; --orange: #f59e0b; --purple: #a855f7;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }

.header {
  text-align: center;
  padding: 32px 0 24px;
  border-bottom: 1px solid var(--border);
}
.header h1 { font-size: 2rem; font-weight: 700; margin-bottom: 4px; }
.header h1 .icon { font-size: 1.6rem; margin-right: 8px; }
.header .subtitle { color: var(--text2); font-size: 0.95rem; }
.nav-links { margin-top: 12px; }
.nav-links a {
  margin: 0 8px;
  padding: 6px 16px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 0.85rem;
  transition: all .2s;
  display: inline-block;
}
.nav-links a:hover { border-color: var(--accent); background: rgba(79,140,255,.1); text-decoration: none; }

.container { max-width: 1200px; margin: 0 auto; padding: 24px 16px; }

.empty-state {
  text-align: center;
  padding: 80px 20px;
  color: var(--text2);
}
.empty-state .icon { font-size: 4rem; margin-bottom: 20px; display: block; }
.empty-state h2 { font-size: 1.3rem; color: var(--text); margin-bottom: 12px; }
.empty-state p { max-width: 500px; margin: 0 auto; font-size: 0.95rem; line-height: 1.7; }

/* Report List */
.report-list { display: flex; flex-direction: column; gap: 16px; }

.report-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  cursor: pointer;
  transition: all 0.2s;
}
.report-card:hover { border-color: var(--accent); transform: translateY(-1px); }
.report-card.active { border-color: var(--accent); }

.report-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
.report-name { font-size: 1.15rem; font-weight: 600; }
.report-code { color: var(--text2); font-size: 0.85rem; margin-left: 8px; }
.report-date { color: var(--text2); font-size: 0.8rem; }

.rating {
  display: inline-block;
  padding: 3px 12px;
  border-radius: 20px;
  font-size: 0.78rem;
  font-weight: 600;
}
.rating-strong-buy { background: rgba(34,197,94,0.15); color: var(--green); }
.rating-buy { background: rgba(34,197,94,0.1); color: #4ade80; }
.rating-hold { background: rgba(245,158,11,0.15); color: var(--orange); }
.rating-sell { background: rgba(239,68,68,0.15); color: var(--red); }
.rating-na { background: rgba(139,143,163,0.15); color: var(--text2); }

.score-bar {
  display: flex;
  gap: 16px;
  margin-top: 12px;
  flex-wrap: wrap;
}
.score-item {
  background: rgba(79,140,255,0.08);
  border: 1px solid rgba(79,140,255,0.15);
  padding: 6px 14px;
  border-radius: 8px;
  font-size: 0.82rem;
}
.score-item .label { color: var(--text2); }
.score-item .val { font-weight: 600; margin-left: 6px; }
.score-item .val.high { color: var(--green); }
.score-item .val.mid { color: var(--orange); }
.score-item .val.low { color: var(--red); }

/* Detail */
.detail-panel {
  display: none;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 30px;
  margin-top: 16px;
  animation: fadeIn 0.3s;
}
.detail-panel.show { display: block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

.detail-section {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--border);
}
.detail-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.detail-section h3 {
  font-size: 1rem;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.detail-section h3 .dot { width: 4px; height: 16px; border-radius: 2px; background: var(--accent); }

.metric-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 10px;
}
.metric {
  display: flex;
  justify-content: space-between;
  padding: 8px 12px;
  background: rgba(255,255,255,0.02);
  border-radius: 6px;
}
.metric .k { color: var(--text2); font-size: 0.88rem; }
.metric .v { font-weight: 600; font-size: 0.88rem; }

.summary-text {
  color: var(--text2);
  font-size: 0.92rem;
  line-height: 1.75;
  white-space: pre-wrap;
}

.footer {
  text-align: center;
  padding: 24px;
  color: var(--text2);
  font-size: 0.8rem;
  border-top: 1px solid var(--border);
  margin-top: 40px;
}
</style>
</head>
<body>

<div class="header">
  <h1><span class="icon">ğŸ°</span>åŸºæœ¬é¢åˆ†ææŠ¥å‘Š</h1>
  <p class="subtitle">å·´è²ç‰¹è§†è§’ Â· å››ç»´è¯„ä¼°æ¡†æ¶</p>
  <div class="nav-links">
    <a href="index.html">â† é¦–é¡µ</a>
    <a href="factor-backtest.html">å› å­å›æµ‹</a>
    <a href="paper-trading.html">æ¨¡æ‹Ÿç›˜</a>
    <a href="technical.html">æŠ€æœ¯åˆ†æ</a>
  </div>
</div>

<div class="container">
  <div id="report-list" class="report-list"></div>
  <div id="detail-panel" class="detail-panel"></div>
  <div id="empty-state" class="empty-state" style="display:none;">
    <span class="icon">ğŸ“­</span>
    <h2>æš‚æ— åˆ†ææŠ¥å‘Š</h2>
    <p>é€šè¿‡ AI åŠ©æ‰‹è¿è¡Œã€Œå·´è²ç‰¹è§†è§’åˆ†æã€åï¼ŒæŠ¥å‘Šä¼šè‡ªåŠ¨å±•ç¤ºåœ¨è¿™é‡Œã€‚<br>ç¤ºä¾‹æŒ‡ä»¤ï¼šã€Œå¸®æˆ‘åˆ†æä¸€ä¸‹è´µå·èŒ…å°ã€</p>
  </div>
</div>

<div class="footer">
  Alpha Factor Lab Â· <a href="index.html">è¿”å›é¦–é¡µ</a>
</div>

<script>
const DATA_FILE = 'fundamental-reports.json';

function scoreClass(v) {
  if (v >= 7) return 'high';
  if (v >= 4) return 'mid';
  return 'low';
}

function ratingClass(r) {
  const map = { 'å¼ºçƒˆæ¨è': 'strong-buy', 'æ¨è': 'buy', 'ä¸­æ€§': 'hold', 'å›é¿': 'sell' };
  return 'rating-' + (map[r] || 'na');
}

function renderMetrics(obj) {
  if (!obj || typeof obj !== 'object') return '';
  return '<div class="metric-grid">' +
    Object.entries(obj).map(([k,v]) =>
      `<div class="metric"><span class="k">${k}</span><span class="v">${v}</span></div>`
    ).join('') + '</div>';
}

function renderDetail(r) {
  const panel = document.getElementById('detail-panel');
  let html = '';

  if (r.industry) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ­ è¡Œä¸šå®šä½ä¸äº§ä¸šé“¾</h3>`;
    const ind = r.industry;
    let indText = '';
    if (ind.summary) indText += ind.summary + '\n\n';
    if (ind.position) indText += 'äº§ä¸šé“¾ä½ç½®ï¼š' + ind.position + '\n';
    if (ind.market_size) indText += 'å¸‚åœºè§„æ¨¡ï¼š' + ind.market_size + '\n';
    if (ind.growth) indText += 'å¢é•¿è¶‹åŠ¿ï¼š' + ind.growth + '\n';
    if (ind.competition) indText += 'ç«äº‰æ ¼å±€ï¼š' + ind.competition;
    html += `<p class="summary-text">${indText}</p>`;
    html += '</div>';
  }
  if (r.moat) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ° æŠ¤åŸæ²³åˆ†æ</h3>`;
    if (r.moat.summary) html += `<p class="summary-text">${r.moat.summary}</p>`;
    if (r.moat.metrics) html += renderMetrics(r.moat.metrics);
    html += '</div>';
  }
  if (r.earnings) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ“Š ç›ˆåˆ©è´¨é‡</h3>`;
    if (r.earnings.summary) html += `<p class="summary-text">${r.earnings.summary}</p>`;
    if (r.earnings.metrics) html += renderMetrics(r.earnings.metrics);
    html += '</div>';
  }
  if (r.health) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ’° è´¢åŠ¡å¥åº·</h3>`;
    if (r.health.summary) html += `<p class="summary-text">${r.health.summary}</p>`;
    if (r.health.metrics) html += renderMetrics(r.health.metrics);
    html += '</div>';
  }
  if (r.valuation) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ“ ä¼°å€¼åˆç†æ€§</h3>`;
    if (r.valuation.summary) html += `<p class="summary-text">${r.valuation.summary}</p>`;
    if (r.valuation.metrics) html += renderMetrics(r.valuation.metrics);
    html += '</div>';
  }
  if (r.management) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ‘” ç®¡ç†å±‚ä¸æ²»ç†</h3>`;
    if (r.management.summary) html += `<p class="summary-text">${r.management.summary}</p>`;
    if (r.management.key_people) html += `<p class="summary-text">${r.management.key_people.map(x=>'â€¢ '+x).join('\n')}</p>`;
    html += '</div>';
  }
  if (r.catalysts) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ“° å‚¬åŒ–ä¸åŠ¨æ€</h3>`;
    if (r.catalysts.summary) html += `<p class="summary-text">${r.catalysts.summary}</p>`;
    if (r.catalysts.events) html += `<p class="summary-text">${r.catalysts.events.map(x=>'â€¢ '+x).join('\n')}</p>`;
    if (r.catalysts.outlook) html += `<p class="summary-text" style="margin-top:8px;color:var(--text2);">${r.catalysts.outlook}</p>`;
    html += '</div>';
  }
  if (r.conclusion) {
    html += `<div class="detail-section"><h3><span class="dot"></span>ğŸ“ ç»¼åˆç»“è®º</h3>`;
    html += `<p class="summary-text">${r.conclusion}</p>`;
    html += '</div>';
  }
  if (r.risks) {
    html += `<div class="detail-section"><h3><span class="dot"></span>âš ï¸ é£é™©æç¤º</h3>`;
    html += `<p class="summary-text">${Array.isArray(r.risks) ? r.risks.map(x=>'â€¢ '+x).join('\n') : r.risks}</p>`;
    html += '</div>';
  }

  panel.innerHTML = html;
  panel.classList.add('show');
}

async function init() {
  const listEl = document.getElementById('report-list');
  const emptyEl = document.getElementById('empty-state');
  const panel = document.getElementById('detail-panel');

  let reports = [];
  try {
    const resp = await fetch(DATA_FILE + '?t=' + Date.now(), {cache: 'no-cache'});
    if (!resp.ok) throw new Error('no data');
    reports = await resp.json();
  } catch(e) {
    emptyEl.style.display = 'block';
    return;
  }

  if (!reports.length) {
    emptyEl.style.display = 'block';
    return;
  }

  reports.sort((a,b) => (b.date||'').localeCompare(a.date||''));

  listEl.innerHTML = reports.map((r, i) => {
    const moatScore = r.moat?.score ?? '-';
    const earningsScore = r.earnings?.score ?? '-';
    const healthScore = r.health?.score ?? '-';
    const valScore = r.valuation?.score ?? '-';
    return `
    <div class="report-card" data-idx="${i}">
      <div class="report-top">
        <div>
          <span class="report-name">${r.name||'æœªçŸ¥'}</span>
          <span class="report-code">${r.code||''}</span>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
          <span class="rating ${ratingClass(r.rating)}">${r.rating||'æœªè¯„çº§'}</span>
          <span class="report-date">${r.date||''}</span>
        </div>
      </div>
      <div class="score-bar">
        <div class="score-item"><span class="label">æŠ¤åŸæ²³</span><span class="val ${typeof moatScore==='number'?scoreClass(moatScore):''}">${moatScore}/10</span></div>
        <div class="score-item"><span class="label">ç›ˆåˆ©è´¨é‡</span><span class="val ${typeof earningsScore==='number'?scoreClass(earningsScore):''}">${earningsScore}/10</span></div>
        <div class="score-item"><span class="label">è´¢åŠ¡å¥åº·</span><span class="val ${typeof healthScore==='number'?scoreClass(healthScore):''}">${healthScore}/10</span></div>
        <div class="score-item"><span class="label">ä¼°å€¼</span><span class="val ${typeof valScore==='number'?scoreClass(valScore):''}">${valScore}/10</span></div>
      </div>
    </div>`;
  }).join('');

  let activeIdx = -1;
  listEl.querySelectorAll('.report-card').forEach(card => {
    card.addEventListener('click', () => {
      const idx = parseInt(card.dataset.idx);
      listEl.querySelectorAll('.report-card').forEach(c => c.classList.remove('active'));

      // æ”¶èµ·ï¼šç‚¹å‡»å·²å±•å¼€çš„å¡ç‰‡
      if (idx === activeIdx) {
        activeIdx = -1;
        panel.classList.remove('show');
        panel.remove();
        document.getElementById('report-list').appendChild(panel);
        return;
      }

      activeIdx = idx;
      card.classList.add('active');
      renderDetail(reports[idx]);

      // æŠŠè¯¦æƒ…é¢æ¿æ’åˆ°å½“å‰å¡ç‰‡æ­£ä¸‹æ–¹
      card.insertAdjacentElement('afterend', panel);
      panel.classList.add('show');

      // å¹³æ»‘æ»šåŠ¨ï¼Œè®©å¡ç‰‡+è¯¦æƒ…éƒ½åœ¨è§†é‡å†…
      setTimeout(() => {
        card.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 50);
    });
  });
}

init();
</script>
</body>
</html>
